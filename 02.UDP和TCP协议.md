### UDP/TCP/IP协议：

#### 1.UDP协议：

##### 1.1UDP的校验和使用了一种很简单粗暴的CRC校验：

- [ ] **取每个字节，把每个字节的数据一次循环相加，得到一个最终数字，就是校验和。**
- [ ] **接收端按照同样的规则再次计算校验和。和发送端的校验和进行对比，如果数据一致就可以认为数据没有发生错误。**

##### 2.特点：

- [ ] **无连接：**
- [ ] **不可靠：**
- [ ] **面向数据报：**
- [ ] 全双工：

3. 冗余（异地多活）：加强了可靠性，但是降低数据的一致性《大型网站技术架构》

#### ==2.TCP协议==

##### 2.1 TCP的设计核心

- [ ] **可靠性：发送者能知道自己发送成功没成功**
- [ ] **传输效率：可靠性的前提下尽量提高传输效率**

> **确认应答：保证可靠性的核心机制**
>
> - 为了区分当前是应答哪个数据，需要引入序号和确认序号概念：
>   - 序号是给每个字节都编上号。
>   - 确认序号表示的是当前序号之前的数据已经都收到了，同时也意味着向发送端索要当前确认序号开始的数据
>
> **超时重传：也是可靠传输中最核心的机制。**
>
> - 传输一条数据没有确认应答的时候，等待一段时间，然后进行重传，重传可能会重复若干次，重传的次数越多，丢包的概率也就越小。重传的等待时间间隔，也在一次变长。

##### 2.2 连接管理

###### 2.2.1 三次握手建立连接

- [ ] **建立链接的意义：**
  - **双方各自试探对方的读写数据的能力，看是否合适建立连接**
  - **双方可以在建立连接过程中协商一些必要的数据（TCP的序号的基准值）**
- [ ] **三次握手具体过程：**
  - **客户端先发起一个连接的请求（SYN同步报文段）；服务器收到SYN后会立刻返回一个确认报文ACK，同时回复的这个ACK也是一个SYN；客户端收到SYN之后再返回一个ACK**
- [ ] **涉及到的重要状态：**
  - **LISTEN状态：服务器端的状态，表示手机开机、信号良好，随时可以接收连接请求**
  - **ESTABLISHED状态：stable[译：稳定]  表示别人的请求，你接收了，连接已经建立完成，随时可以通信了**

![](https://github.com/beerNewbie/Network-Foundation/blob/master/image/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png)



> 三次握手中中间两次操作100%是合在一起的
>
> 四次挥手中间两次操作可能合在一起，也可能不合

###### 2.2.2 四次挥手断开连接

- [ ] **CLOSE_WAIT：等待程序调用close来完成最终的断开连接过程**

  - **如果一个服务器上出现大量的CLOSE_WAIT是啥情况？**

    > **就是代码中有bug，代码里的close忘记调用了，或者未执行到**

- [ ] **TIME_WAIT：虽然此时程序可能都已经结束了，但是还要保持连接为TIME_WAIT状态一段时间，因为发送的最后一个ACK可能会丢**

  - **TIME_WAIT等待时间是2MSL**
  - **MSL：称为网络上两个主机之间数据传输的理论最大时间，在Centos7上默认是60秒**

![](https://github.com/beerNewbie/Network-Foundation/blob/master/image/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.png)
